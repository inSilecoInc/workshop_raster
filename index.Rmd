---
title: "Raster with R"
author: "inSileco Team"
date: "2020/12/15"
output:
  xaringan::moon_reader:
    css: [default, rd.css, rd-font.css, "hygge"]
    lib_dir: assets
    seal: false
    nature:
      highlightStyle: dracula
      countIncrementalSlides: false
      beforeInit: "macros.js"
---


class: title-slide, middle


## .font200[`r icon::fontawesome("r-project")`asters]

<br><br>

.instructors[
  .font180[Manipulate raster files with `r icon::fontawesome("r-project")`]
  <br><br><br>
  .authors140[David Beauchesnes & Kevin Cazelles]
  <br><br>
  `r format(Sys.time(), '%B %d, %Y')`
]

<br><br><br><br><br><br>


<img src="img/logoW.png" width="150px"></img>



```{r setup, include = FALSE}
knitr::opts_chunk$set(
  comment = "#>>",
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  fig.width = 7,
  fig.height = 5.25,
  fig.align = 'center',
  width = 120
)
mypar <- list(fg = "#37abc8", bg = "transparent", las = 1)
library(icon)
```

---

class: inverse, center, middle

# Learning objectives

![:custom_hr]()

## .font160[`r icon::fontawesome("map")`  + `r icon::fontawesome("r-project")`]


---

# Learning objectives

<br>

1. Understand the benefits of manipulating raster files with `r icon::fontawesome("r-project")`

--

2. Learn how to read and write raster files with `r icon::fontawesome("r-project")`

--

3. Learn how to manipulate rasters `r icon::fontawesome("r-project")`

--

4. Learn how to visualize rasters with `r icon::fontawesome("r-project")`


---

class: inverse, center, middle

# `r icon::fontawesome("info-circle")` Rationalize

![:custom_hr]()

## Why use `r icon::fontawesome("r-project")` for rasters? (~15min)


???

If after the workshop if what follows makes sense and you feel it is kid of true, it would a success. 




---

# Raster files 

> Raster files are grids of equally sized cells (or pixels) that all have a value (or a missing value) 

--

> Cells are georeferenced: coordinates + CRS 

--

> Commonly used to represent continuous phenomenon (e.g. temperature, elevation) and images (airborne or satellite imagery)



---
# Raster files 

- Examples of raster file formats: 

  - **GeoTIFF** (see https://trac.osgeo.org/geotiff)
  - **NetCDF** (see https://www.unidata.ucar.edu/software/netcdf/)
  - **KML** (also supports vector objects, see https://www.ogc.org/standards/kml/)
  - **GeoPackage** (also supports vector objects, see https://www.ogc.org/standards/geopackage)
  


---
# About `r icon::fontawesome("r-project")`

> R is a programming language and free software environment for statistical computing and graphics supported by the R Foundation for Statistical Computing. &nbsp;&nbsp; [Wikipedia](https://en.wikipedia.org/wiki/R_(programming_language)

--

.center[![:scale 50%](https://roelverbelen.netlify.app/img/hex-stickers.png)]



---
# Coding vs clicking

### 1. Programming/coding allows to automate what is frequently done!

--

### 2. Allow to make an analysis/a report reproducible 

--

  - create data pipeline 
  - for colleagues and future you

--

### 3. Increase efficiency (spend more time thinking)


--

### 4. Empowerment 


???

One is not better than the other

---
# Why `r icon::fontawesome("r-project")`?

<br>

### 1. Freeware + Open source

--

### 2. Package ecosystem is rich and under active development  

--

### 3. Community is wide, involved, responsive

--

### 4. You are most likely already using it!

--

### 5. Many packages connect `r icon::fontawesome("r-project")` to other software/langage

--

### **`r icon::fontawesome("arrow-right")` Very little cannot be done with `r icon::fontawesome("r-project")`**


???

Very few people look at the R source code but many people are now involved in package dev via GH or GL.

R Python Julia, whatever, language itself matters less that these
If you have time to learn a bit it might sometime makes sense, notably to work with other colleagues.





---

class: inverse, center, middle

# `r icon::fontawesome("pen")` Input/Ouput 

![:custom_hr]()

## Read and write raster files (45min)

???

Will introduce a bit more package to deal with raster in R


---
# `r icon::fontawesome("r-project")` packages ecosystem for spatial objects

## Classes and Methods 

--

### Vectors (not our main focus)

- [`sp`](https://CRAN.R-project.org/package=sp)
- [`sf`](https://CRAN.R-project.org/package=sf) `r icon::fontawesome("check")`

--

### Rasters

- [`raster`](https://CRAN.R-project.org/package=raster) `r icon::fontawesome("check")`
- [`stars`](https://CRAN.R-project.org/package=stars) `r icon::fontawesome("check")`
- [`terra`](https://CRAN.R-project.org/package=terra) 


???

Not visualisation later 



---
# Raster packages

### [`raster`](https://CRAN.R-project.org/package=raster) .font90[03/2010 (1.0.0) &nbsp; // &nbsp; 11/2020 (3.3-7)]
  
<br>

--
  
### [`terra`](https://CRAN.R-project.org/package=terra) .font90[03/2019 (0.5-2) &nbsp; // &nbsp; 11/2020 (0.9-11)]
  
> terra is an R package that replaces raster. It has a very similar interface, but it is simpler and much faster. 

<br>
--
  
### [`stars`](https://CRAN.R-project.org/package=stars) .font90[07/2018  (0.1-1) &nbsp; // &nbsp; 07/2020 (0.4-3)]
  
> Reading, manipulating, writing and plotting spatiotemporal arrays (raster and vector data cubes) in 'R'. 

Depends on [`sf`](https://CRAN.R-project.org/package=sf).
Note that `stars` and `sf` are [Tidyverse](https://www.tidyverse.org/) friendly.



---
# Package [raster](https://CRAN.R-project.org/package=raster)

More details



---
# Package [stars](https://CRAN.R-project.org/package=stars): SpatioTemporal ARrayS

## Raster and Vector Datacubes

.center[[![:scale 58%](https://raw.githubusercontent.com/r-spatial/stars/master/images/cube3.png)](https://r-spatial.github.io/stars/index.html)] 
.right[.font60[see https://r-spatial.github.io/stars/index.html]]



---
# Example file 

![Accessed 16/12/2020](img/gebco.png)

https://download.gebco.net/ (-73/-41 62/37) see `data`



---
# read with raster


```{R read_raster}
library(raster)
rar <- raster("data/bathy.tif")  
class(rar)
```

---
# read with stars


```{R read_stars}
library(stars)
ras <- read_stars("data/bathy.tif")  
class(ras)
```



---
# Recap 


| operation             | *raster*                | *stars*                |
|:----------------------|:------------------------|:-----------------------|
| read                  | `raster()`              | `read_stars()`         |
| read                  | `raster()`              | `read_stars()`         |








---
# `r icon::fontawesome("terminal")` R as a raster file converter 

```{r, echo = FALSE}
countdown::countdown(minutes = 5, seconds = 0)
```

### Convert `bathy.tif` into `bathy.gpkg` 



<br>

  











---

class: inverse, center, middle

# `r icon::fontawesome("cogs")` Manipulate 

![:custom_hr]()

## Do whatever you need with raster files (~1h30)



---
# Common operation 

- change projection 
- clip/mask 
- extraction
- basic calculations (e.g. average per regions, min/max)
- stack 
- resample 
- rasterization/polygonation 


---
# Change projection 



---
# Clip 




---
# Mask 



---
# Extraction



---
# Recap 


| operation             | `raster`                | `stars`                |
|:----------------------|:------------------------|:-----------------------|
| reprojection          | projectRaster()         | st_transform()         |







---

class: inverse, center, middle

# `r icon::fontawesome("map")` Visualize

![:custom_hr]()

## Static visualization (~1h)



---
# `r icon::fontawesome("r-project")` packages ecosystem for spatial objects

## Visualization

--

### Static

- [`tmap`](https://CRAN.R-project.org/package=tmap)
- [`ggmap`](https://CRAN.R-project.org/package=ggmap)

--

### Interactive 

- [`rasterVis`](https://CRAN.R-project.org/package=rasterVis)
- [`leaflet`](https://CRAN.R-project.org/package=leaflet)
- [`mapview`](https://CRAN.R-project.org/package=mapview)





---
# Exercice + countdown

1. Do that 
2. Do that 
3. Do that 
4. Do that 
5. Do that 

```{r, echo = FALSE}
countdown::countdown(minutes = 5, seconds = 0)
```


---

# Resources `r icon::fontawesome("link")`

- [Geocomputation with R](https://geocompr.robinlovelace.net/)
- [Blog R-spatial](https://www.r-spatial.org/)
- [Open Geospatial Consortium](https://www.ogc.org/)
- https://nowosad.github.io/BioGIS_19/workshop/#64